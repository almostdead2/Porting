name: Android ROM Porting

on:
  workflow_dispatch:
    inputs:
      firmware_url:
        description: 'Direct URL to the OnePlus Firmware ZIP file'
        required: true
        default: 'https://example.com/your_oneplus_firmware.zip'

jobs:
  port_rom:
    runs-on: ubuntu-latest
    timeout-minutes: 300
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Run ROM Porting Script
        run: |
          chmod +x ./port_rom.sh
          ./port_rom.sh "${{ github.event.inputs.firmware_url }}"
        env:
          GITHUB_RUN_NUMBER: ${{ github.run_number }}

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          files: ${{ env.ROM_ZIP_PATH }}
          tag_name: ${{ env.RELEASE_TAG }}
          name: Manual Port ROM Release - ${{ env.ROM_FILENAME }}
          body: |
            OnePlus OEM ROM Port - ${{ env.ROM_FILENAME }}

            This release contains the ported ROM for your device.
            This build was automatically generated.

            Changes included:
            - Custom build.prop modifications
            - `services.jar` patched for build consistency check bypass
            - Unwanted apps removed
            - Custom `init` binary (if provided)
            - System partition merged and re-imaged
            - Empty keylayout files created

            Flash at your own risk.
